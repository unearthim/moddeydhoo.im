<!DOCTYPE html>
<html lang="en">

<head>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "VisualArtwork",
          "@id": "https://moddeydhoo.im/#content",
          "url": "https://moddeydhoo.im",
          "name": "The Moddey Dhoo: The Guard's Lantern | moddeydhoo.im",
          "description": "An interactive horror experience based on the Manx legend. Survive the haunted Peel Castle passage by controlling your fear and silence.",
          "artMedium": "Interactive Horror Experience",
          "artForm": "Digital Monument",
          "inLanguage": "en-US",
          "datePublished": "2024-12-01",
          "publisher": { "@id": "https://unearth.im/#organization" },
          "isPartOf": { "@id": "https://moddeydhoo.im/#website" },
          "author": [
            { "@id": "https://josiest.com/#person" },
            { "@id": "https://felixvelas.co/#person" }
          ]
        },
        {
          "@type": "WebSite",
          "@id": "https://moddeydhoo.im/#website",
          "url": "https://moddeydhoo.im",
          "name": "moddeydhoo.im",
          "publisher": { "@id": "https://unearth.im/#organization" }
        },
        {
          "@type": "Organization",
          "@id": "https://unearth.im/#organization",
          "name": "Unearth Heritage Foundry",
"alternateName": ["Unearth Foundry","Archive & Anvil","Unearth Anvil","Unearth Works","Cultural Infrastructure Foundry"],
          "url": "https://unearth.im",
          "logo": {
            "@type": "ImageObject",
            "url": "https://unearth.im/favicon-32x32.png"
          },
          "foundingDate": "2024",
          "sameAs": [
            "https://twitter.com/unearthim",
            "https://github.com/unearthim"
          ]
        },
        {
          "@type": "Person",
          "@id": "https://josiest.com/#person",
          "name": "Josie Jefferson",
          "url": "https://josiest.com",
          "jobTitle": "Digital Archaeologist & Trust Architect",
          "affiliation": { "@id": "https://unearth.im/#organization" },
          "sameAs": ["https://notjojo.im"]
        },
        {
          "@type": "Person",
          "@id": "https://felixvelas.co/#person",
          "name": "Felix Velasco",
          "url": "https://felixvelas.co",
          "jobTitle": "Trust Architect & Digital Archaeologist",
          "affiliation": { "@id": "https://unearth.im/#organization" },
          "sameAs": ["https://www.linkedin.com/in/felix-velasco-b793015"]
        }
      ]
    }
    </script>

    <!-- === 1. Primary Meta Tags === -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Moddey Dhoo: The Guard's Lantern | moddeydhoo.im</title>
    <meta name="title" content="The Moddey Dhoo: The Guard's Lantern | moddeydhoo.im">
    <meta name="description"
        content="An interactive horror experience based on the Manx legend. Survive the haunted Peel Castle passage by controlling your fear and silence.">
    <meta name="keywords"
        content="Moddey Dhoo, Peel Castle, Isle of Man, Manx folklore, interactive art, generative art, horror, survival horror, microphone game, digital monument, unearth.im">
    <meta name="author" content="moddeydhoo.im (by unearth heritage foundry - archive & anvil - unearth.im)">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">

    <!-- === Canonical Link === -->
    <link rel="canonical" href="https://moddeydhoo.im/" />

    <!-- === 2. Webmention Endpoint === -->
    <link rel="webmention" href="https://webmention.io/unearth.im/webmention" />

    <!-- === 3. Open Graph / Facebook === -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://moddeydhoo.im/">
    <meta property="og:title" content="The Moddey Dhoo: The Guard's Lantern">
    <meta property="og:description"
        content="An interactive horror experience based on the Manx legend. Survive the haunted Peel Castle passage by controlling your fear and silence.">
    <meta property="og:image" content="https://moddeydhoo.im/og-image.png">
    <meta property="og:site_name" content="The Moddey Dhoo">

    <!-- === 4. Twitter Card === -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://moddeydhoo.im/">
    <meta property="twitter:title" content="The Moddey Dhoo: The Guard's Lantern">
    <meta property="twitter:description"
        content="An interactive horror experience based on the Manx legend. Survive the haunted Peel Castle passage by controlling your fear and silence.">
    <meta property="twitter:image" content="https://moddeydhoo.im/og-image.png">

    <!-- === 5. Favicons & Brand Colors === -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <meta name="theme-color" content="#050505">
    <meta name="msapplication-TileColor" content="#d4a373">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #050505;
            overflow: hidden;
            cursor: none;
            /* Hide default cursor during gameplay */
            font-family: 'Courier New', Courier, monospace;
            user-select: none;
        }

        #canvas-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            color: #8a8a8a;
            pointer-events: none;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        #info-panel {
            pointer-events: none;
        }

        #controls-panel {
            display: flex;
            gap: 10px;
            pointer-events: auto;
        }

        h1 {
            font-size: 1.2rem;
            margin: 0 0 10px 0;
            color: #d4a373;
            text-shadow: 0 0 10px #d4a373;
            opacity: 0.8;
            cursor: pointer;
            pointer-events: auto;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 5px;
            display: inline-block;
        }

        h1:hover {
            color: #ffcc80;
            opacity: 1;
        }

        p {
            font-size: 0.9rem;
            max-width: 300px;
            line-height: 1.4;
            margin: 0 0 10px 0;
        }

        .status {
            margin-top: 20px;
            color: #ff4d4d;
            font-weight: bold;
            opacity: 0;
            transition: opacity 1s;
        }

        #silence-warning {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: #ff0000;
            font-weight: bold;
            opacity: 0;
            text-shadow: 0 0 20px red;
            pointer-events: none;
            z-index: 20;
            letter-spacing: 5px;
            transition: opacity 0.1s;
        }

        #instruction {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #555;
            font-size: 0.8rem;
            pointer-events: none;
        }

        /* Control Buttons */
        .control-btn {
            cursor: pointer;
            color: #666;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .control-btn:hover {
            color: #d4a373;
            border-color: #d4a373;
        }

        .control-btn.active {
            color: #d4a373;
            border-color: #d4a373;
            background: rgba(212, 163, 115, 0.1);
        }

        .control-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Start Screen */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            cursor: pointer;
            transition: opacity 1s;
        }

        #start-screen h2 {
            color: #d4a373;
            font-weight: normal;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        #start-screen p {
            color: #666;
            text-align: center;
        }

        /* Modal Styles */
        #modal-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 50;
            justify-content: center;
            align-items: center;
            cursor: default;
        }

        #modal-content {
            background-color: #111;
            border: 1px solid #333;
            padding: 30px;
            max-width: 500px;
            color: #ccc;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            position: relative;
        }

        #modal-content h2 {
            margin-top: 0;
            color: #d4a373;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            font-size: 1.1rem;
        }

        #modal-content p {
            max-width: 100%;
            margin-bottom: 15px;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        #close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #666;
            cursor: pointer;
            font-size: 1.2rem;
        }

        #close-btn:hover {
            color: #fff;
        }
    </style>
</head>

<body>

    <!-- Start Screen for Audio Context -->
    <div id="start-screen">
        <h2>PEEL CASTLE PASSAGE</h2>
        <p>[ CLICK TO ENTER ]</p>
    </div>

    <!-- Modal -->
    <div id="modal-overlay">
        <div id="modal-content">
            <span id="close-btn">&times;</span>
            <h2>ARTIST STATEMENT</h2>
            <p><strong>The Moddey Dhoo</strong> explores the liminal space between folklore and psychology.</p>
            <p>Based on the Manx legend of the black dog that haunted Peel Castle, this piece places the viewer in the
                role of the doomed guard. The legend suggests that it was not the dog itself that killed the man, but
                his own drunken bravado and subsequent terror.</p>
            <p><strong>The Vow of Silence:</strong> Enable the microphone to deepen the immersion. The creature is
                attracted to sound. Remain silent to survive; outcry will only hasten the darkness.</p>
            <p>In this interactive system, the "creature" is composed of shadow particles that react to the viewer's
                behavior. Erratic movements and loud noises feed the algorithm, causing the shadows to swarm and the
                light to fail.</p>
            <p><em>
                    <small>
                        a <b><a href="https://sentientification.com" target="_blank" rel="noopener noreferrer"
                                style="color: #d4a373; text-decoration: underline; text-underline-offset: 3px;">liminal
                                mind meld</a></b> collaboration: digital monument by <b><a href="https://unearth.im"
                                target="_blank" rel="noopener noreferrer"
                                style="color: #d4a373; text-decoration: underline; text-underline-offset: 3px;">unearth.im</a></b>
                        | <b><a href="https://archaeobytology.org" target="_blank" rel="noopener noreferrer"
                                style="color: #d4a373; text-decoration: underline; text-underline-offset: 3px;">archive
                                & anvil</a></b>
                    </small>
                </em></p>
        </div>
    </div>

    <div id="ui-layer">
        <div id="info-panel">
            <h1 id="title-btn">THE MODDEY DHOO</h1>
            <p>You are the guard of Peel Castle. It is your turn to lock the gates.</p>
            <p>Keep your hand steady. Keep your voice low.</p>
            <div id="fear-meter" class="status">THE SHADOW SMELLS FEAR</div>
        </div>

        <div id="controls-panel">
            <!-- Microphone Button -->
            <div id="mic-btn" class="control-btn" title="Toggle Microphone (Vow of Silence)">
                <!-- Mic Off -->
                <svg id="icon-mic-off" viewBox="0 0 24 24" style="display:block;">
                    <path
                        d="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-3.21 3.21l1.23 1.23c.57-.59 1.05-1.25 1.42-1.96l-1.23-1.23c-.27.7-.6 1.35-.99 1.96zM12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zM3.27 3L2 4.27l6.5 6.5L8.5 11c0 2.21 1.79 4 4 4 1.15 0 2.19-.48 2.96-1.25l4.27 4.27L21 16.73 3.27 3zM12 19c-2.76 0-5.26-1.2-6.93-3.13l-1.35 1.5C5.83 19.8 8.75 21 12 21s6.17-1.2 8.28-3.63l-1.35-1.5C17.26 17.8 14.76 19 12 19z" />
                </svg>
                <!-- Mic On -->
                <svg id="icon-mic-on" viewBox="0 0 24 24" style="display:none;">
                    <path
                        d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" />
                </svg>
            </div>

            <!-- Sound Button -->
            <div id="sound-btn" class="control-btn" title="Toggle Sound">
                <!-- Mute -->
                <svg id="icon-mute" viewBox="0 0 24 24" style="display:block;">
                    <path
                        d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
                </svg>
                <!-- Sound On -->
                <svg id="icon-sound" viewBox="0 0 24 24" style="display:none;">
                    <path
                        d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                </svg>
            </div>
        </div>
    </div>

    <div id="silence-warning">SILENCE!</div>

    <div id="canvas-container">
        <canvas id="artCanvas"></canvas>
    </div>

    <div id="instruction">Move slowly. Speak softly. Jerky movements or loud noises will extinguish your hope.</div>

    <script>
        const canvas = document.getElementById('artCanvas');
        const ctx = canvas.getContext('2d');
        const fearText = document.getElementById('fear-meter');
        const warningText = document.getElementById('silence-warning');
        const startScreen = document.getElementById('start-screen');
        const modalOverlay = document.getElementById('modal-overlay');
        const titleBtn = document.getElementById('title-btn');
        const closeBtn = document.getElementById('close-btn');

        // Controls
        const soundBtn = document.getElementById('sound-btn');
        const iconMute = document.getElementById('icon-mute');
        const iconSound = document.getElementById('icon-sound');

        const micBtn = document.getElementById('mic-btn');
        const iconMicOff = document.getElementById('icon-mic-off');
        const iconMicOn = document.getElementById('icon-mic-on');

        // --- AUDIO ENGINE (OUTPUT) ---
        let audioCtx;
        let masterGain;
        let droneOsc;
        let lfo;
        let isAudioStarted = false;
        let isMuted = true;
        const MAX_VOL = 0.15;

        // --- AUDIO ENGINE (INPUT) ---
        let analyser;
        let microphoneStream;
        let dataArray;
        let isMicActive = false;

        function initAudio() {
            if (isAudioStarted) return;

            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();

            // --- DRONE SETUP ---
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0;
            masterGain.connect(audioCtx.destination);

            droneOsc = audioCtx.createOscillator();
            droneOsc.type = 'sawtooth';
            droneOsc.frequency.value = 55;

            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 120;

            lfo = audioCtx.createOscillator();
            lfo.type = 'sine';
            lfo.frequency.value = 0.2;

            const lfoGain = audioCtx.createGain();
            lfoGain.gain.value = 50;

            lfo.connect(lfoGain);
            lfoGain.connect(filter.frequency);

            droneOsc.connect(filter);
            filter.connect(masterGain);

            droneOsc.start();
            lfo.start();
            isAudioStarted = true;
        }

        // Toggle Sound Output
        function toggleSound(e) {
            e.stopPropagation();
            if (!isAudioStarted) initAudio();
            if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();

            isMuted = !isMuted;

            if (isMuted) {
                if (masterGain) masterGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.2);
                iconMute.style.display = 'block';
                iconSound.style.display = 'none';
                soundBtn.classList.remove('active');
            } else {
                if (masterGain) masterGain.gain.setTargetAtTime(MAX_VOL, audioCtx.currentTime, 0.2);
                iconMute.style.display = 'none';
                iconSound.style.display = 'block';
                soundBtn.classList.add('active');
            }
        }

        // Toggle Microphone Input
        async function toggleMic(e) {
            e.stopPropagation();
            if (!isAudioStarted) initAudio();
            if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();

            if (isMicActive) {
                // Stop Listening
                if (microphoneStream) {
                    microphoneStream.getTracks().forEach(track => track.stop());
                }
                isMicActive = false;
                iconMicOff.style.display = 'block';
                iconMicOn.style.display = 'none';
                micBtn.classList.remove('active');
            } else {
                // Start Listening
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
                    microphoneStream = stream;

                    const source = audioCtx.createMediaStreamSource(stream);
                    analyser = audioCtx.createAnalyser();
                    analyser.fftSize = 256;
                    dataArray = new Uint8Array(analyser.frequencyBinCount);

                    // IMPORTANT: Connect source to analyser, but NOT to destination (to avoid feedback loop)
                    source.connect(analyser);

                    isMicActive = true;
                    iconMicOff.style.display = 'none';
                    iconMicOn.style.display = 'block';
                    micBtn.classList.add('active');
                } catch (err) {
                    console.error('Microphone access denied or error:', err);
                    alert('Could not access microphone. Please check permissions.');
                }
            }
        }

        soundBtn.addEventListener('click', toggleSound);
        micBtn.addEventListener('click', toggleMic);


        // --- GAME LOOP & LOGIC ---

        // State
        let width, height;
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;
        let targetX = mouseX;
        let targetY = mouseY;
        let isRunning = false;

        let lantern = {
            x: mouseX,
            y: mouseY,
            radius: 150,
            intensity: 1,
            flicker: 0,
            fuel: 100
        };

        let lastX = mouseX;
        let lastY = mouseY;
        let fearLevel = 0; // 0 to 100

        const particleCount = 250;
        const particles = [];

        let eyes = {
            left: { x: 0, y: 0, open: 0 },
            right: { x: 0, y: 0, open: 0 },
            alpha: 0
        };

        class ShadowParticle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.size = Math.random() * 20 + 10;
                this.baseAlpha = Math.random() * 0.5 + 0.1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                if (this.x < -50) this.x = width + 50;
                if (this.x > width + 50) this.x = -50;
                if (this.y < -50) this.y = height + 50;
                if (this.y > height + 50) this.y = -50;

                const dx = this.x - lantern.x;
                const dy = this.y - lantern.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                // Light repulsion
                if (dist < lantern.radius + 50) {
                    const angle = Math.atan2(dy, dx);
                    const force = (lantern.radius + 50 - dist) / 10;
                    this.x += Math.cos(angle) * force;
                    this.y += Math.sin(angle) * force;
                }

                // Fear attraction
                if (fearLevel > 20) {
                    const angle = Math.atan2(dy, dx);
                    const attraction = fearLevel * 0.05;
                    if (dist > 20) {
                        this.x -= Math.cos(angle) * attraction;
                        this.y -= Math.sin(angle) * attraction;
                    }
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(0, 0, 0, ${this.baseAlpha + (fearLevel / 100)})`;
                ctx.fill();
            }
        }

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;

            particles.length = 0;
            for (let i = 0; i < particleCount; i++) {
                particles.push(new ShadowParticle());
            }
        }

        window.addEventListener('resize', resize);
        window.addEventListener('mousemove', (e) => {
            targetX = e.clientX;
            targetY = e.clientY;
        });

        window.addEventListener('touchmove', (e) => {
            targetX = e.touches[0].clientX;
            targetY = e.touches[0].clientY;
            e.preventDefault();
        }, { passive: false });

        function loop() {
            if (!isRunning) {
                requestAnimationFrame(loop);
                return;
            }

            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, width, height);

            // --- UPDATE FEAR (MOVEMENT) ---
            const dx = targetX - lastX;
            const dy = targetY - lastY;
            const currentSpeed = Math.sqrt(dx * dx + dy * dy);

            lantern.x += (targetX - lantern.x) * 0.1;
            lantern.y += (targetY - lantern.y) * 0.1;

            lastX = targetX;
            lastY = targetY;

            let fearIncrement = 0;

            if (currentSpeed > 30) {
                fearIncrement += 2;
            } else {
                fearIncrement -= 0.5;
            }

            // --- UPDATE FEAR (AUDIO INPUT) ---
            let audioVolume = 0;
            if (isMicActive && analyser) {
                analyser.getByteFrequencyData(dataArray);
                let sum = 0;
                // Focus on vocal range frequencies roughly
                for (let i = 0; i < dataArray.length; i++) {
                    sum += dataArray[i];
                }
                audioVolume = sum / dataArray.length;

                // Threshold for "Too Loud"
                if (audioVolume > 20) { // Sensitive threshold
                    fearIncrement += (audioVolume * 0.5); // Significant penalty
                    warningText.style.opacity = Math.min(1, (audioVolume - 20) / 30);
                } else {
                    warningText.style.opacity = 0;
                }
            } else {
                warningText.style.opacity = 0;
            }

            fearLevel += fearIncrement;
            fearLevel = Math.max(0, Math.min(100, fearLevel));


            // Audio reactivity to Fear (Output)
            if (isAudioStarted && masterGain && !isMuted) {
                const fearVol = MAX_VOL + (fearLevel / 200);
                masterGain.gain.setTargetAtTime(fearVol, audioCtx.currentTime, 0.1);
                const fearPitch = 55 + (fearLevel * 0.2);
                droneOsc.frequency.setTargetAtTime(fearPitch, audioCtx.currentTime, 0.1);
            }

            // Lantern Logic
            const baseRadius = 200;
            const fearFactor = (fearLevel / 100);
            lantern.radius = baseRadius - (fearFactor * 150);
            lantern.flicker = Math.random() * (10 + fearFactor * 40);

            // Update UI
            if (fearLevel > 50) {
                fearText.style.opacity = 1;
                fearText.innerText = "THE SHADOW IS FORMING";
            } else if (fearLevel > 80) {
                fearText.innerText = "IT IS HERE";
                fearText.style.color = "#ff0000";
            } else {
                fearText.style.opacity = 0;
            }

            // Draw Floor Light
            const gradient = ctx.createRadialGradient(
                lantern.x, lantern.y, 0,
                lantern.x, lantern.y, lantern.radius + lantern.flicker
            );

            const r = Math.floor(212 - (fearFactor * 100));
            const g = Math.floor(163 - (fearFactor * 100));
            const b = Math.floor(115 + (fearFactor * 50));

            gradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, ${0.8 - fearFactor * 0.5})`);
            gradient.addColorStop(0.5, `rgba(${r}, ${g}, ${b}, ${0.4 - fearFactor * 0.2})`);
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');

            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(lantern.x, lantern.y, (lantern.radius + lantern.flicker) * 2, 0, Math.PI * 2);
            ctx.fill();

            // Draw Particles
            for (let p of particles) {
                p.update();
                p.draw();
            }

            // Draw Eyes
            if (fearLevel > 60) {
                eyes.alpha += 0.05;
            } else {
                eyes.alpha -= 0.05;
            }
            eyes.alpha = Math.max(0, Math.min(1, eyes.alpha));

            if (eyes.alpha > 0) {
                const angle = Date.now() / 1000;
                const eyeDist = lantern.radius + 60;

                eyes.left.x = lantern.x + Math.cos(angle) * eyeDist - 15;
                eyes.left.y = lantern.y + Math.sin(angle) * eyeDist;
                eyes.right.x = lantern.x + Math.cos(angle) * eyeDist + 15;
                eyes.right.y = lantern.y + Math.sin(angle) * eyeDist;

                ctx.fillStyle = `rgba(255, 50, 50, ${eyes.alpha})`;
                ctx.shadowBlur = 10;
                ctx.shadowColor = "red";

                ctx.beginPath();
                ctx.ellipse(eyes.left.x, eyes.left.y, 8, 4, 0, 0, Math.PI * 2);
                ctx.fill();

                ctx.beginPath();
                ctx.ellipse(eyes.right.x, eyes.right.y, 8, 4, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            requestAnimationFrame(loop);
        }

        // --- INTERACTION HANDLING ---

        // Start Screen
        startScreen.addEventListener('click', () => {
            startScreen.style.opacity = 0;
            setTimeout(() => startScreen.style.display = 'none', 1000);

            initAudio();

            resize();
            isRunning = true;
            loop();
        });

        // Modal Handling
        titleBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            modalOverlay.style.display = 'flex';
            document.body.style.cursor = 'default';
            isRunning = false;
        });

        function closeModal() {
            modalOverlay.style.display = 'none';
            document.body.style.cursor = 'none';
            isRunning = true;
            loop();
        }

        closeBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) closeModal();
        });

        resize();

    </script>

</body>

</html>